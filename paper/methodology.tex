\section{Dataset and Methodology}\label{sec:methodology}

The analysis presented in the remainder of this paper is based on the results
of 21.3M DNS {\tt A} and {\tt AAAA} resolution requests for 717 domains sent to
7,428 IPv4- and IPv6-capable resolvers located in a 106 countries.
%
In this section, we explain our process for identifying resolver targets for
our queries (\Cref{sec:methodology:resolvers}), domains that are the subject of
our queries (\Cref{sec:methodology:domains}), and our process for identifying
the occurrence of a censorship event from the results of each query
(\Cref{sec:methodology:censorship}).

\subsection{Selecting resolvers} \label{sec:methodology:resolvers}
%
Our work is aimed at characterizing the inconsistencies that exist in the
handling of IPv4- and IPv6-related DNS queries --- \ie differences in the
handling of {\tt A} and {\tt AAAA} query types over IPv4 and IPv6
connections. Therefore, we required that each resolver used for our
measurements was IPv4- and IPv6-capable.
%

\para{Identifying resolvers with IPv4- and IPv6-capabilities.}
Our approach, described below, borrows from the work of Hendricks \etal
\cite{hendriks2017potential} who identified IPv6 open resolvers to measure the
potential for IPv6-based DDoS attacks.

\parait{Creating control domains.}
We begin by creating two new domains, owned and controlled by us and used
exclusively for this study. The Name Servers for each domain were also
controlled by us. The Name Server for one of these domains was hosted on
an IPv6-only network without the capability of communicating with IPv4.
%
Note that because these domains were newly registered, they could not have been
present on the blocklists of any censor. We refer to these domains as our
{control and and IPv6-only NS domains}.
%

\parait{Identifying IPv4-capable resolvers.}
We then use {\tt zmap} \cite{Durumeric13zmap} to scan the entire IPv4 address
space and issue a DNS {\tt A} query on port 53 for our IPv4 control
domain. This yields an initial list of IPv4 DNS resolvers.
%

\parait{Verifying IPv6 capabilities of IPv4-capable resolvers.}
Next, we issue a DNS {\tt A} query for a resolver-specific subdomain of our
IPv6 control domain to each of these IPv4 DNS resolvers. The subdomain encoded
the IPv4 address of the resolver being targeted. Therefore, if our domain was
{\tt v6onlyNS.io} and our resolver target was {\tt 1.1.1.1}, our DNS query
requested the {\tt A} record for {\tt 1-1-1-1.v6onlyNS.io}.
%
Since IPv4-only resolvers will not be able to communicate with our IPv6-only
Name Server, we expect this resolution to fail. On the other hand, resolvers
with any form of IPv6 connectivity will be able to connect to our IPv6-only
Name Server.
%
Thus, by examining the logs of our IPv6-only NS domain, we are able
to identify the set of resolvers that successfully reached our server and
their corresponding IPv4 addresses. The associated IPv6 address for each
successful query is extracted from packet captures of the IPv6-only Name
Server giving us an (IPv4, IPv6) address pair for each resolver.

\para{Filtering and geolocating resolvers.}
The approach detailed above yields pairs that suggest the presence of
`infrastructure' resolvers --- \eg multiple IPv4 resolvers have the same IPv6
address associated with them. These are cases where the IPv4 resolver simply
forwards requests to a dedicated multi-machine DNS infrastructure rather than
performing the resolution by itself. Although this does not change the validity
of our results regarding the IPv6-related inconsistencies of resolvers, we
still remove these cases in order to minimize the influence of such
infrastructure resolvers.
%
Finally, to confirm the correctness of our list of IPv4/IPv6 resolver pairs,
we: (1) perform a follow up scan by issuing {\tt A} and {\tt AAAA} requests for
both our control domains using {\tt zdns} \cite{Durumeric13zmap} and filter out
those pairs where an incorrect response was received, (2) we use the Maxmind
GeoIP dataset \cite{maxmind-connectiondb} to geolocate the IPv4 and IPv6
addresses of a resolver pair and only those which belong to the same region.
% 
In total, we obtained 7,428 resolvers in 106 different countries.
\Cref{sec:appendix:resolver-distribution} illustrates how these resolvers were
geographically distributed.


\subsection{Identifying Domains of interest}\label{sec:methodology:domains}

Censored Planet's Satellite project~\cite{sundara2020censored} has cultivated a
list of domains that are potentially censored globally or by individual
countries. This list provides a starting point for identifying domains of
interest to our study.

To measure how censorship varies over IPv4 and IPv6 Network Interfaces we
restrict our list of domains to those that have both \texttt{A} and
\texttt{AAAA} Records. To filter this list we again use \texttt{zdns} to perform
both \texttt{A} and \texttt{AAAA} Record Requests for each domain from
Satellite's global list through Google and Cloudflare's public DNS resolvers
(\texttt{8.8.8.8, 8.8.4.4, 1.1.1.1,} and \texttt{1.0.0.1}).

We filter our domain list to those domains that have valid IPv4 addresses in
their \texttt{A} Records and valid IPv6 addresses in their \texttt{AAAA}
Records.

To facilitate the next step of determining when a domain is censored we take the
Answers provided from our DNS queries and issue follow up TLS connections using
\texttt{zgrab2}~\cite{Durumeric13zmap} and locally verify the returned TLS
certificates.

Our domain list is then filtered to those domains that:
\begin{packed_enumerate}
    \item Have an IPv4 address in their \texttt{A} Record
    \item Have an IPv6 address in their \texttt{AAAA} Record
    \item Issue a valid TLS certificate for the domain on both the IPv4 and IPv6
    address in their \texttt{A/AAAA} Records
\end{packed_enumerate}

On January 24, 2022 this gave us 717 domains, originally identified by Censored
Planet as potentially interesting from a censorship point of view that meet our
criteria to measure censorship across network interfaces.

\subsection{Determining DNS censorship}\label{sec:methodology:censorship}

To measure DNS censorship across Network Interfaces we then perform both
\texttt{A} and \texttt{AAAA} Record Requests for our filtered 717 domains from
each IP address of all 7,788 resolver pairs.

We then take each answer provided by every resolver and make a TLS connection
with the Server Name of the domain we queried the resolver for and retrieve any
returned TLS certificate.

We then verify each DNS query we made to determine if any answers provided
failed to successfully return a valid TLS certificate, if so we label the DNS
query from that resolver for that domain and resource Record as censored.
